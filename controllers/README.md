REST-CONTROLLERS
================

The `controllers`-folder contains all the _http-logic_ for chriba.no's restful api.

## Url - tables
Bellow is the routes used for the rest-api.

### Admin
- `GET /api/admin` - **Requires token**. Will fetch details about the current admin
- `POST /api/admin` - Registeres a new admin-user (_disabled in production_)
- `PATCH /api/admin` - **Requires token**. Updates admin details
- `DELETE /api/admin` - **Requires token**. Deletes the current admin (_disabled in production_)

#### Fetch Token
- `POST /api/admin/token` - Will authenticate the admin, and returns a token if authenticated

### Estate
- `GET /api/estates` - Fetches all estates on the site
- `GET /api/estates/:name` - Fetches a specific estate
- `POST /api/estates` - **Requires token**. Creates a new estate
- `PATCH /api/estates/:name` - **Requires token**. Updates a specific estate
- `DELETE /api/estates/:name` - **Requires token**. Destroys a specific estate

#### Thumbnail-management
- `POST /api/estates/thumb/:name?size=[large | small]` - **Requires token**. Uploads a thumbnail (body-field is named `file`) to the estate
- `POST /api/estates/thumb/:name?size[large | small]&path=<string>` - **Requires token**. Deletes a thumbnail from estate (`path` can be put in body)

### Project
- `GET /api/projects` - Fetches all projects on the site
- `GET /api/projects/:name` - Fetches a specific project
- `POST /api/projects` - **Requires token**. Creates a new project
- `PATCH /api/projects/:name` - **Requires token**. Updates a specific project
- `DELETE /api/projects/:name` - **Requires token**. Destroys a specific project

#### Thumbnail-management
- `POST /api/projects/thumb/:name?size=[large | small]` - **Requires token**. Uploads a thumbnail (body-field is named `file`) to the project
- `POST /api/projects/thumb/:name?size[large | small]&path=<string>` - **Requires token**. Deletes a thumbnail from project (`path` can be put in body)

### About chriba
- `GET /api/general` - Fetches the general information about chriba. i.e. _about_
- `PATCH /api/general` - Updates the general information

## Request and Response format
Denotes how the requests should be formatted,
and what you can expect as response.

> `?` denotes an optional value

### Estates and Projects

#### POST `/api/estates|projects`
```
# Request

## Http-Header
Authorization: bearer <token>
Content-Type: application/json

## Http-Body
{
    "title": String, // Only for project
    "description"?: String,
    "url"?: String,
    "location": { // Only for estates
        "address": String,
        "addressNumber"?: String,
        "postalCode"?: String,
        "city"?: String
        "country"?: String,
        "lat": Number, // Coordinates matching the address-fields
        "long": Number
    }
}

# Response
## Http-Header
Status: 201

## Http-Body
{
    "_id": ObjectId,
    "name": String, // Autogenerated from `title` or `location`-values

    // same as http-body in request...
}
```

#### PATCH `/api/estates|projects/:name`

```
# Request

## Http-Header
Authorization: bearer <token>
Content-Type: application/json

## Http-Body
{
    "title"?: String, // Only for project
    "description"?: String,
    "url"?: String,
    "location": { // Only for estates
        "address"?: String,
        "addressNumber"?: String,
        "postalCode"?: String,
        "city"?: String
        "country"?: String,
        "lat": Number, // Coordinates matching the address-fields
        "long": Number
    }
}

# Response
## Http-Header
Status: 200

## Http-Body
{
    // The updates values from the request-body
}
```

#### DELETE `/api/estates|projects/:name`

```
# Request

## Http-Header
Authorization: bearer <token>

# Response

## Http-Header
Status: 204
```

#### POST `/api/estates|projects/thumb/:name?size=[large|small]`

```
# Request

## Http-Header
Authorization: bearer <token>
Content-Type: multipart/form-data // Do not manually add in header, automatically identified by clients

## Http-Body
file: <file blob...>

# Response

## Http-Header
Status: 200

## Http-Body
{
    // Project- or estate-object with the new values
}
```

### Admin

#### POST `/api/admin`
```
# Request
## Http-Header
Content-Type: application/json

## Http-Body
{
    "firstName": String,
    "lastName": String,
    "email": String, // Must be unique
    "password": String, // Min 8 chars, with number and large and small letters
    "confirmPassword": String
}

# Response
## Http-Header
Status: 201

## Http-Body
{
    "_id": ObjectId,
    "firstName": String,
    "lastName": String,
    "email": String,
    "created": Date
}
```

#### PATCH `/api/admin`
```
# Request
## Http-Header
Authorization: bearer <token>
Content-Type: application/json

## Http-Body
{
    "firstName": String,
    "lastName": String,
    "email": String,
    "oldPassword": String, // If present, will require `password` and `confirmPassword` to be present
    "password": String, // The new password
    "confirmPassword": String // Confirm new password
}

# Response
## Http-Header
Status: 200

## Http-Body
{
    "firstName": String,
    "lastName": String,
    "email": String,
    "created": Date
}
```

#### POST `/api/admin/token`
```
# Request
## Http-Header
Content-Type: application/json

## Http-Body
{
    "email": String,
    "password": String
}

# Response
# Http-Header
Status: 200

#Http-Body
{
    "token": "<token>"
}
```

### General
Pretty similar to _Estates_ and _Projects_, just with the correct values


